kind: pipeline
name: default

steps:
- name: build
  image: golang
  commands:
  - git fetch --tags
  - make build/linux_amd64.tar.gz
  - make build/darwin_amd64.tar.gz
  - make build/windows_amd64.tar.gz
  when:
    event: tag
- name: publish
  image: plugins/github-release
  settings:
    api_key:
      from_secret: github_token
    files: build/*
    checksum:
        - md5
    title: {DRONE_TAG}
    note: CHANGELOG.md
  when:
    event: tag
